!function(a){var b=function(a){return new Date(a.toISOString().split("T")[0]+"T12:00:00-04:30")},c=function(a){return a instanceof Date?b(a):Array.isArray(a)?b(new Date(a[0],a[1]-1,a[2])):new Date(a+"T12:00:00-04:30")},d={callback:null,chart_labels:null,chart_types:null,initialized:!1,selected:"trend",toggle_button:null,bind:function(a){this.callback=a},execCallback:function(a){this.callback&&this.callback("chartChangeRequest",a)},init:function(b){var e,c=this.selected;return this.toggle_button=b,e="trend"==c?"season":"trend",a(b).addClass(c),a(b).button({label:this.chart_labels[e]}),a(b).click(function(){d.toggle()}),this.initialized=!0,this},install:function(a){return this.ui_manager=a,this},select:function(b){"trend"==b?(a(this.toggle_button).hasClass("season")&&(a(this.toggle_button).removeClass("season"),a(this.toggle_button).addClass("trend"),a(this.toggle_button).button({label:this.chart_labels.season})),this.selected="trend",this.initialized&&this.execCallback("trend")):"season"==b&&(a(this.toggle_button).hasClass("trend")&&(a(this.toggle_button).removeClass("trend"),a(this.toggle_button).addClass("season"),a(this.toggle_button).button({label:this.chart_labels.trend})),this.selected="season",this.initialized&&this.execCallback("season"))},toggle:function(){a(this.toggle_button).hasClass("trend")?(a(this.toggle_button).removeClass("trend"),a(this.toggle_button).addClass("season"),a(this.toggle_button).button({label:this.chart_labels.trend}),this.selected="season",this.execCallback("season")):a(this.toggle_button).hasClass("season")&&(a(this.toggle_button).removeClass("season"),a(this.toggle_button).addClass("trend"),a(this.toggle_button).button({label:this.chart_labels.season}),this.selected="trend",this.execCallback("trend"))}},e={anchor:null,button_url:null,callbacks:{},current_year:null,datepicker:"#ui-datepicker-div",datepicker_input:null,date_format:"yy-mm-dd",initialized:!1,max_date:null,min_date:null,selected:null,show_months:!0,show_years:!1,year_range:null,bind:function(a,b){this.callbacks[a]=b},callback:function(a){return this.callbacks[a]},dateRange:function(){return 0==arguments.length?{min_date:this.min_date,max_date:this.max_date}:void(2==arguments.length&&(this.min_date=c(arguments[0]),this.max_date=c(arguments[1])))},execCallback:function(a,b){if(this.initialized&&a in this.callbacks){this.callbacks[a](a,b)}},init:function(b,d){this.datepicker_input=d,this.anchor=b;var f={autoclose:!0,beforeShow:function(){a(e.datepicker).hide(),a(e.anchor).append(a(e.datepicker))},buttonImage:this.button_url,buttonImageOnly:!0,buttonText:this.button_label,changeMonth:this.month_menu,changeYear:this.year_menu,dateFormat:this.date_format,gotoCurrent:!0,onSelect:function(b,d){e.selected=c(b),e.execCallback("dateChanged",b),a("#ui-datepicker-div").hide()},showAnim:"clip",showButtonPanel:!1,showOn:"button",showOtherMonths:!0};return null!=this.max_date&&null!=this.min_date&&(f.maxDate=this.max_date,f.minDate=this.min_date),null!=this.year_range&&(f.changeYear=!0,f.yearRange=this.year_range),a(this.datepicker_input).datepicker(f),this.initialized=!0,a(this.datepicker).hide(),a(this.datepicker_input).change(function(){e.execCallback("dateChanged",this.value)}),this.initialized=!0,null!=this.selected?this.select(this.selected):this.select((new Date).toISOString().split("T")[0]),this},install:function(a){return this.ui_manager=a,this},select:function(b){b&&(this.selected=c(b)),this.initialized&&a(this.datepicker_input).datepicker("setDate",this.selected)},yearRange:function(){if(0==arguments.length)return{min_year:this.min_year,max_year:this.max_year};if(1==arguments.length){var a=arguments[0],b=arguments[1];this.year_range=a.toString()+":"+b.toString(),this.max_year=b,this.min_year=a}}},f={address_anchor:null,address_text:'<span class="grapehard-current-address">{{ address }}</span>',callbacks:{},change_button:null,initialized:!1,lat_text:null,lng_text:null,selected:null,ui_manager:null,bind:function(a,b){this.callbacks[a]=b},callback:function(a){return this.callbacks[a]},default:function(a){this.select(a,!1)},execCallback:function(b,c){if(this.initialized){var d=this.callbacks[b];if("undefined"!==a.type(d)){var e=c;return"undefined"===a.type(e)&&(e=this.selected),d(b,e),!0}return!1}},init:function(b,c,d,e){return this.address_anchor=c,this.lat_text=d,this.lng_text=e,this.change_button=b,this.update(this.selected),a(b).button({label:"Change Location"}),a(b).click(function(){f.execCallback("locationChangeRequest")}),this.initialized=!0,this},install:function(a){return this.ui_manager=a,this},locationsAreDifferent:function(a,b){return a.address!=b.address||a.lat!=b.lat||a.lng!=b.lng},select:function(b,c){selected=a.extend({},b);null==this.selected||this.locationsAreDifferent(selected,this.selected)?(this.initialized&&this.update(selected),"variety"in b&&this.ui_manager.variety_ui.select(b.variety,!1),selected&&c!==!1&&this.execCallback("locationChanged",a.extend({},selected)),this.selected=selected):selected.key!=this.selected.key&&(this.selected.key=selected.key)},setDefault:function(b){this.default_location=a.extend({},b)},update:function(b){var c=null,d=selected.address.indexOf(", USA");c=d>0?selected.address.replace(", USA",""):selected.address;var e=c.split(", ");c=e.length>1?this.address_text.replace("{{ address }}",e[0])+"</br>"+this.address_text.replace("{{ address }}",e.slice(1).join(", ")):this.address_text.replace("{{ address }}",c),a(this.address_anchor).empty().append(c),a(this.lat_text).empty().append(b.lat.toFixed(6)),a(this.lng_text).empty().append(b.lng.toFixed(6))}},g=function(){var b=a(h.input_checked).val();h.select(b,!0)},h={anchor:null,callback:null,initialized:!1,input_checked:null,input_selector:null,selected:null,varieties:null,bind:function(a){this.callback=a},default:function(){if(0==arguments.length)return this.default_variety;if(1==arguments.length){var a=arguments[0];a!=this.default_variety&&(this.default_variety=a)}},execCallback:function(a){this.initialized&&this.callback&&this.callback("varietyChanged",a)},init:function(b,c){return this.anchor=b,this.input_checked='input[name="'+c+'"]:checked',this.input_selector='input[name="'+c+'"][value="{{ variety }}"]',a.each(document.getElementsByName(c),function(){this.addEventListener("click",g)}),this.selected&&this.toggle(this.selected),this.initialized=!0,this},install:function(a){return this.ui_manager=a,this},select:function(a,b){this.initialized?(a!=this.selected&&this.toggle(a),b!==!1&&this.execCallback(a)):this.selected=a},setVarieties:function(b){this.varieties=a.extend({},b)},toggle:function(b){var c=a(this.input_checked).val();c!=b&&a(this.input_selector.replace("{{ variety }}",c)).prop("checked",!1),a(this.input_selector.replace("{{ variety }}",b)).prop("checked",!0),this.selected=a(this.input_checked).val()},variety:function(){return a(this.input_checked).val()}},i={anchor_element:null,dom:['<div id="grapehard-location">','<span class="csftool-em">Current Location :</span>','<div id="grapehard-location-address"> </div>','<span class="csftool-em">Latitude : </span><span id="grapehard-current-lat"> </span>','<br/><span class="csftool-em">Longitude : </span><span id="grapehard-current-lng"> </span>','<button id="grapehard-change-location"></button>',"</div>",'<div id="grapehard-date">','<span class="csftool-em">Date of Interest:</span>','<div id="grapehard-date-selector">','<input type="text" id="grapehard-datepicker">',"</div>","</div>",'<div id="grapehard-varieties">','<span class="csftool-em">Grape Variety</span>','<form id="variety-selector">','<input type="radio" name="select-grape-variety" id="cab_franc" value="cab_franc"></input>&nbsp;Cabernet Franc<br/>','<input type="radio" name="select-grape-variety" id="concord" value="concord"></input>&nbsp;Concord<br/>','<input type="radio" name="select-grape-variety" id="riesling" value="riesling"></input>&nbsp;Riesling',"</form>","</div>",'<div id="grapehard-chart-button">','<div id="grapehard-toggle-display">','<button id="grapehard-toggle-button"></button>',"</div>","</div>","</div>"].join(""),address_anchor:"#grapehard-location-address",chart_selector:"#grapehard-toggle-button",chart_ui:null,date_ui:null,date_ui_anchor:"#grapehard-date-selector",datepicker_input:"#grapehard-datepicker",lat_element:"#grapehard-current-lat",location_button:"#grapehard-change-location",location_ui:null,lng_element:"#grapehard-current-lng",variety_inputs:"select-grape-variety",variety_ui:null,variety_ui_anchor:"#variety-selector",initInterfaces:function(){h.init(this.variety_ui_anchor,this.variety_inputs),d.init(this.chart_selector),e.init(this.date_ui_anchor,this.datepicker_input),f.init(this.location_button,this.address_anchor,this.lat_element,this.lng_element)},installHtml:function(a){return a.innerHTML=this.dom,this.anchor_element=a.id,this.chart_ui=d.install(this),this.date_ui=e.install(this),this.location_ui=f.install(this),this.variety_ui=h.install(this),this}},j={chart_ui:null,date_ui:null,location_ui:null,ui_manager:null,variety_ui:null,init:function(b,c){this.ui_manager=i.installHtml(b),this.chart_ui=this.ui_manager.chart_ui,this.date_ui=this.ui_manager.date_ui,this.location_ui=this.ui_manager.location_ui,this.variety_ui=this.ui_manager.variety_ui;var d=this;return c&&a.each(c,function(a,b){d.option.apply(d,b)}),this.ui_manager.initInterfaces(),this},option:function(){var b=arguments.length,c=arguments[0];if(1==b)switch(c){case"chart":return this.chart_ui.selected;case"date":return this.date_ui.selected;case"location":return a.extend({},this.location_ui.current_location);case"variety":return this.variety_ui.selected;case"varieties":return this.variety_ui.varieties}else if(2==b)switch(c){case"callback":switch(arguments[1]){case"chartChangeRequest":return this.chart_ui.callback;case"dateChanged":return this.date_ui.callback("dateChanged");case"locationChanged":return this.location_ui.callback("locationChanged");case"locationChangeRequest":return this.location_ui.callback("locationChangeRequest");case"varietyChangeRequest":return this.variety_ui.callback;case"yearChanged":return this.date_ui.callback("yearChanged")}break;case"chart":switch(arguments[1]){case"hide_selector":this.chart_ui.hideChartSelector();break;case"selected":return this.chart_ui.selected;case"show_selector":this.chart_ui.showChartSelector();break;case"toggle":this.chart_ui.toggle();break;case"types":return a.extend({},this.chart_ui.chart_types);default:this.chart_ui.select(arguments[1])}break;case"date":switch(arguments[1]){case"range":return{min_date:this.date_ui.min_date,max_date:this.date_ui.max_date};case"initial":return i.initial_date;case"years":this.date_ui.year_range;break;default:this.date_ui.select(arguments[1])}break;case"location":this.location_ui.select(arguments[1]);break;case"variety":arguments[1];switch(arguments[1]){case"selected":return this.variety_ui.selected;case"checked":return this.variety_ui.checked();default:this.variety_ui.select(arguments[1])}break;case"varieties":this.variety_ui.setVarieties(arguments[1]);break;case"variety":this.variety_ui.select(arguments[1])}else if(3==b)switch(c){case"bind":switch(arguments[1]){case"chartChangeRequest":this.chart_ui.bind(arguments[2]);break;case"dateChanged":this.date_ui.bind("dateChanged",arguments[2]);break;case"locationChanged":this.location_ui.bind("locationChanged",arguments[2]);break;case"locationChangeRequest":this.location_ui.bind("locationChangeRequest",arguments[2]);break;case"varietyChanged":this.variety_ui.bind(arguments[2]);break;case"yearChanged":this.date_ui.bind("yearChanged",arguments[2])}break;case"chart":switch(arguments[1]){case"default":this.chart_ui.select(arguments[2],!1);break;case"labels":this.chart_ui.chart_labels=a.extend({},arguments[2]);break;case"types":this.chart_ui.chart_types=a.extend([],arguments[2])}break;case"date":switch(arguments[1]){case"button":this.date_ui.button_url=arguments[2];break;case"range":this.date_ui.dateRange.apply(this.date_ui,arguments[2]);break;case"select":this.date_ui.select(arguments[2]);break;case"years":this.date_ui.yearRange.apply(this.date_ui,arguments[2])}break;case"location":"default"==arguments[1]&&this.location_ui.select(arguments[2],!1);break;case"select":switch(arguments[1]){case"chart":this.chart_ui.select(arguments[2]);break;case"date":this.date_ui.select(arguments[2]);break;case"variety":this.variety_ui.select(arguments[2])}}else if(4==b)if("date"==c){var e=arguments[1];"range"==e?this.date_ui.dateRange(arguments[2],arguments[3]):"years"==e&&this.date_ui.yearRange(arguments[2],arguments[3])}else"select"==c&&"variety"==arguments[1]&&this.variety_ui.select(arguments[2],arguments[3])}};a.fn.GrapeHardinessUserInterface=function(a){var b=this.get(0),c=j.init(b,a);return c}}(jQuery),function(a){var b=function(){var b='<span style="font-size:12px;font-weight:bold;text-align:center">'+Highcharts.dateFormat("%b %d, %Y",this.x)+"</span>";return a.each(this.points,function(){"line"==this.series.type&&(b+="<br/>"+this.y+' : <span style="color:'+this.color+'">'+this.series.name+"</span>")}),b},c={area_threshold:-999,callbacks:{},chart:null,chart_anchor:"#csftool-display-chart",chart_labels:{},chart_type:null,chart_config:{chart:{type:"area"},plotOptions:{series:{states:{hover:{enabled:!0,halo:!1}}}},credits:{text:"Powered by NRCC",href:"http://www.nrcc.cornell.edu/",color:"#000000"},title:{text:"Grape Hardiness @ T50"},subtitle:{text:"location address",style:{"font-size":"14px",color:"#000000"}},xAxis:{type:"datetime",crosshair:{width:1,color:"#ff0000",snap:!0,zIndex:10},labels:{style:{color:"#000000"}},dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:"%d %b",week:"%d %b",month:"%b<br/>%Y",year:"%Y"}},yAxis:{title:{text:"Temperature",style:{"font-size":"14px",color:"#000000"}},gridZIndex:4,labels:{style:{color:"#000000"}}},tooltip:{useHtml:!0,shared:!0,borderColor:"#000000",borderWidth:2,borderRadius:8,shadow:!1,backgroundColor:"#ffffff",style:{width:165},xDateFormat:"%b %d, %Y",positioner:function(){return{x:80,y:60}},formatter:b},legend:{floating:!0,backgroundColor:"#ffffff",borderRadius:5,borderWidth:1,align:"left",verticalAlign:"top",x:70,y:50,width:165,zIndex:20},series:[]},components:{hardarea:{name:"T50 Damage Potential",type:"area",zIndex:2,lineWidth:0,color:"#ffb3b3",marker:{enabled:!1,states:{hover:{enabled:!1}}}},hardfcast:{name:"Hardiness Forecast",type:"line",zIndex:12,lineWidth:2,dashStyle:"Dot",color:"#00cc00",marker:{enabled:!0,fillColor:"#00cc00",lineWidth:1,lineColor:"#00cc00",radius:3,symbol:"circle"}},hardtemp:{name:"Hardiness Temp",type:"line",zIndex:11,lineWidth:2,color:"#00cc00",marker:{enabled:!0,fillColor:"#00cc00",lineWidth:1,lineColor:"#00cc00",radius:3,symbol:"circle"}},mintarea:{name:"No Damage Potential",type:"area",zIndex:3,lineWidth:0,color:"#ffffff",fillOpacity:1,showInLegend:!1,marker:{enabled:!1,states:{hover:{enabled:!1}}}},mintemp:{name:"Min Temperature",type:"line",zIndex:13,lineWidth:2,color:"#0000ff",marker:{enabled:!1}},minfcast:{name:"Min Temp Forecast",type:"line",zIndex:14,lineWidth:2,dashStyle:"Dot",color:"#0000ff",marker:{enabled:!0,fillColor:"#0000ff",lineWidth:1,lineColor:"#0000ff",radius:3,symbol:"circle"}}},data:{},default_chart:null,display_anchor:null,dom:'<div id="csftool-display-chart"></div>',drawn:[],event_types:["drawing_complete","series_drawn"],initialized:!1,location:null,required:["hardtemp","mintemp"],season:null,tool:null,variety:null,varieties:null,view:null,highchartsIsAvailable:function(){return"undefined"!=typeof Highcharts},addSeries:function(b,c){if(c&&c.length>1){null!=this.chart&&"undefined"!=typeof this.chart||this.newChart();var d=a.extend(!0,{id:b,data:c},this.components[b]);"hardarea"!=b&&"mintarea"!=b||(d.threshold=this.area_threshold),this.validChart(),this.drawn.indexOf(b)>-1&&this.remove(b),this.chart.addSeries(d,!0),this.drawn.indexOf(b)<0&&this.drawn.push(b),this.execCallback("series_drawn",b)}this.complete()},allDrawn:function(){var b=!0,d=this;return a.each(this.required,function(a,c){d.drawn.indexOf(c)<0&&(b=!1)}),b},bind:function(a,b){this.event_types.indexOf(a)>0&&(this.callbacks[a]=b)},clear:function(){for(;this.chart.series.length>0;)this.chart.series[0].remove(!1);this.drawn=[]},chartHeight:function(a){this.chart_config.chart.height=a},chartLabel:function(a,b){this.chart_labels[a]=b},chartLabels:function(b){this.chart_labels=a.extend(this.chart_labels,b)},chartType:function(a){this.chart_type=a},chartWidth:function(a){this.chart_config.chart.width=a},complete:function(a){this.allDrawn()&&this.execCallback("drawing_complete")},dataExtremes:function(a){var b,c,d=-999,e=999;for(b=0;b<a.length;b++)c=a[b][1],c>d&&(d=c),c<e&&(e=c);return[e,d]},draw:function(){this.tool.logObjectAttrs(this.view);var a=this.tool.fullview("mint",this.view),b=this.dataExtremes(a),c=b[0],d=this.tool.fullview("hardtemp",this.view);b=this.dataExtremes(d),c<b[0]&&(this.area_threshold=c-5,this.addSeries("mintarea",a),this.addSeries("hardarea",d)),this.addSeries("hardtemp",this.tool.observed("hardtemp",this.view)),this.addSeries("hardfcast",this.tool.forecast("hardtemp",this.view)),this.addSeries("mintemp",this.tool.observed("mint",this.view)),this.addSeries("minfcast",this.tool.forecast("mint",this.view))},drawChartLabel:function(){var a=this.season+" "+this.chart_labels[this.chart_type];this.chart.renderer.text(a,325,85).css({color:"#000000",fontSize:"16px"}).add()},drawErrorLabel:function(a){var b=a+" Season is not avalaible";this.chart.renderer.text(b,200,85).css({color:"#ff0000",fontSize:"20px"}).add()},execCallback:function(b,c){var d=this.callbacks[b];d&&(c?d(b,[c,a.extend([],this.drawn)]):d(b,a.extend([],this.drawn)))},init:function(b){this.display_anchor="#"+b.id,a(this.display_anchor).append(this.dom),Highcharts.setOptions({global:{useUTC:!1}}),this.initialized=!0,null==this.chart_type&&(this.chart_type=this.default_chart)},locationChange:function(a){null!=this.location&&a.address==this.location||(this.location=a.address),"variety"in a&&this.varietyChange(a.variety)},newChart:function(){null!=this.chart&&(this.chart.destroy(),this.chart=null);var b=a.extend(!0,{},this.chart_config);b.series=[],b.title.text=this.title(),b.subtitle.text=this.subtitle(),a(this.chart_anchor).highcharts("Chart",b),this.chart=a(this.chart_anchor).highcharts(),0==arguments.length?this.drawChartLabel():this.drawErrorLabel(arguments[0]),this.drawn=[]},redraw:function(){this.newChart(),this.draw()},refresh:function(){this.clear(),this.draw()},remove:function(a){if(null!=this.chart)if("undefined"!=typeof a){var b,c=this.components[a].name,d=this.chart.series.length;for(b=0;b<d;b++)if(this.chart.series[b].name==c){this.chart.series[b].remove();break}}else this.chart.destroy(),this.chart=null},resetExtremes:function(){this.yaxis_max=-999,this.yaxis_min=999},setOption:function(a,b){switch(a){case"chart":case"chart_type":this.chartType(b);break;case"default":this.default_chart=b;break;case"height":this.chartHeight(b);break;case"labels":this.chartLabels(b);break;case"location":this.locationChange(b);break;case"season":this.season=b;break;case"variety":this.varietyChange(b);break;case"varieties":this.varieties=b;break;case"view":this.setView(b);break;case"width":this.chartWidth(b)}},setOptions:function(b){a.each(b,function(a){var d=b[a];for(var e in d)c.setOption(e,d[e])})},setView:function(b){this.view=a.extend({},b)},subtitle:function(){return"@ "+this.location},title:function(){return this.varieties[this.variety]+" T50 Hardiness Temperature"},validChart:function(){null===this.chart&&this.newChart()},varietyChange:function(a){null==this.variety?this.variety=a:a!=this.variety&&(this.variety=a)}},d=function(){if(1==arguments.length)switch(arguments[0]){case"chart":case"chart_type":return c.chart_type;case"chart_anchor":return c.chart_anchor;case"display_anchor":return c.display_anchor;case"draw":c.draw();break;case"drawn":return c.drawn;case"location":return c.location;case"newChart":c.newChart();break;case"redraw":c.redraw();break;case"refresh":c.refresh();break;case"season":return c.season;case"start_date":return c.start_date;case"variety":return c.variety;case"view":return c.view}else if(2==arguments.length){var a=arguments[0],b=arguments[1];switch(a){case"options":c.setOptions(b);break;case"show_error":c.newChart(b);break;default:c.setOption(a,b)}}else"option"==arguments[0]?c.setOption(arguments[1],arguments[2]):"bind"==arguments[0]&&c.bind(arguments[1],arguments[2])};a.fn.GrapeHardinessChart=function(b,e){var f=this.get(0);return c.tool=b,"undefined"!==a.type(e)&&a.each(e,function(a,b){d.apply(d,b)}),c.init(f),[c,d]}}(jQuery);